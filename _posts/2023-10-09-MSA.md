## INNER

### 데이터베이스 구성
	1) 고객사의 특성 및 서비스의 특성에 따라 WAS만을 별개로 구성하고 DB는 Shared DB로 구성하는 경우도 있다.
	* 계정/스키마 미분리 구성
	* 계정만 분리 구성
	* 스키마만 분리 구성
	* 계정/스키마 분리구성
	이렇게 되면 단계별로 data dependency의 유지 정도가 달라지고 DB instance를 같이 쓴다는 측면에서 DB의 장애 전파나, DB Connection을 공유하는 문제는 감수하여야 하나
	Data나 DB Instance에 따른 비용 및 유지보수 용이성 측면에서의 강점이 있으므로 고객사 현장의 특성에 맞는 대안이 될 수 있음

### Shared DB 구성 방안
	* DB통합배경
		- SM의 관리 부담 고려
		- 고객사의 요청
		- 서비스 간 데이터 연관도가 높고 Join 쿼리가 다수
		- 오라클과 OSS DB의 성능 차이 고려
		- DB 사이즈가 작아 DB instance 분리의 부담
		- SQL문 재활용 필요성 제기

	* 절충안으로 Shared DB에 계정과 스키마를 분리하는 것으로 고려
	* DB계정이 다른 마이크로서비스 간의 데이터 참조(CRUD)는 직접 접근이 불가함
	* 마이크로서비스가 타 서비스의 테이블을 참조해야 하는 경우는 타 서비스에서 제공하는 API를 호출하여 응용에서 데이터를 조합하는것이 원칙
	* <span style="background-color:#fff5b1">단, 성능을 고려하여 테이블 복제, CQRS 구성 등의 기법 검토(데이터가 자주 변경되지 않고, Near Real Time 데이터 제공이 가능한 경우)</span>
	
	1) Api Composition
	2) 분산 데이터 조회(CQRS)
	3) 분산 트랜잭션 정책(SAGA패턴(보상트랜잭션)) 

### API 설계
	* Consumer 주도 식별 : 주는 쪽은 누가 내 API를 쓰는지 뭘 줘야 되는지 모를 수 있지만 사용하는 쪽은 필요한 내용을 정확히 알 수 있기 때문
	* URI 포맷 : /auth/com/v1/create/user

	* 비동기 호출
		- 비동기는 분산 서비스 환경에서 서비스간 트랜잭션 호출 방식에서 우선적으로 고려되어야 하는 호출 전략이며 업무 성격에 따라 Notification전략과 처리 순서가 보장되지 않는 특성을 고려한 설계가 필요함

	* 타 마이크로서비스 연계 패턴
		1) Join 해소 - API Compostion
			* Join은 Join에 해당하는 데이터를 API 파라미터를 넘기고, 결과를 리턴받아서 응용 프로그램 내에서 조합하여 사용한다.
		2) 반정규화 - 컬럼 추가
			* Join 해소 시 특정값 한두개만 가져올 경우 API Composition 외에 반정규화를 통한 Join 해소를 고려한다.
			* 고려사항
				- 원본 Table이 먼저 insert 되는 경우 : 컬럼추가 table에 insert 시 원본 테이블의 값을 읽어 해당값을 같이 Insert 한다.
				- 컬럼추가 table이 먼저 insert 되는 경우 : 원본 table에 insert 될때 api를 호출하여 컬럼추가 table에도 해당값을 update 한다.
		3) 테이블 복제
			* 일부 컬럼 만으로는 join 해소가 불가능할 경우 table을 복제해 오는 것을 고려한다.
			* table 복제는 kafka의 connector 기능을 활용한다.
			* 복제해오는 서비스 내에서는 복제된 테이블을 참조하는 모든 쿼리는 원본을 바라보지 않고 복제된 table을 바라본다.(정합성 유지)

### 시스템 명세화
	* 각 레이어별 클래스와 클래스가 갖는 기능 및 API가 식별된다.
	* 타 서비스/시스템 간의 Interaction을 식별한다.
	* 이벤트스토밍 방법의 서비스 식별시 분석단계 SRD를 바탕으로 동기/비동기API/대내외IF를 파악한다.
	* 상세설계/개발로 가기 우ㅏ한 기초가 완성된다.

### 결론
	* 하나의 마이크로서비스는 완결성 있는 트랜잭션을 처리하도록 설계
	* 마이크로서비스 간 동기/비동기 설계를 중심으로 디자인
	* 서비스의 독립성 확보를 위해 비동기식 event 방식으로 서비스 간 연동
	* 다중 마이크로서비스 데이터 조회는 Api Compostion, 데이터 복제 등으로 해소하고, 해당 방안으로 불가할 경우 CQRS를 활용
	* 여러 마이크로서비스가 관련된 분산트랜잭션은 보상 처리 필요 시 saga 패턴을 활용하되 보상 트랜잭션 최소화 설계

### framework
	* 주요기능
		- GUID 채번, 서비스 연계 API, 카프카 연계 API, Exception 처리, 로그/모니터링
		- 필터 : 요청 및 응답에 대한 값 조회 및 공통 처리 수행

	* 로그
		- 이미지로그/업무로그/에러로그 > kafka producer >> kafka > schema registry > kafka connect >> 이미지로그DB/업무로그DB/에러로그DB	
		- 카프카 토픽은 날짜별로 총 31개 한달마다 초기화

## OUTER

### 개요




